# SQL å°æŠ€å·§

#### ðŸ”¥Hive SQLè¡Œè½¬åˆ—

```text
è½¬æ¢ä¹‹å‰çš„æ°´æžœè®¢å•è¡¨ï¼ŒçŽ°åœ¨éœ€è¦æŒ‰å¤©ç»Ÿè®¡æ¯ä¸ªæ°´æžœçš„é”€å”®æ•°é‡
+------------+--------+---------+
|   date     |  type  |  value  |
+------------+--------+---------+
| 2023-02-11 | apple  |   10    |
+------------+--------+---------+
| 2023-02-11 | orange |   15    |
+------------+--------+---------+
| 2023-02-11 | banana |   6     |
+------------+--------+---------+
| 2023-02-11 | mango  |   12    |
+------------+--------+---------+
| 2023-02-11 | apple  |   20    |
+------------+--------+---------+
| 2023-02-12 | mango  |   4     |
+------------+--------+---------+
| 2023-02-12 | mango  |   12    |
+------------+--------+---------+

æœŸæœ›ç»“æžœ
+------------+--------+--------+--------+-------+
|   date     | appele | orange | banana | mango |
+------------+--------+--------+--------+-------+
| 2023-02-11 |   30   |   15   |   6    |   12  |
+------------+--------+--------+--------+-------+
| 2023-02-12 |   4    |   0    |   0    |   18  |
+------------+--------+--------+--------+-------+

```

è½¬æ¢ä¹‹å‰çš„æ°´æžœè®¢å•è¡¨ï¼ŒçŽ°åœ¨éœ€è¦æŒ‰å¤©ç»Ÿè®¡æ¯ä¸ªæ°´æžœçš„é”€å”®æ•°é‡

```sql
SELECT fo.`date`,
       SUM(if(fo.`type` = 'apple',fo.value,0)) as apple,
       SUM(if(fo.`type` = 'orange',fo.value,0)) as orange,
       SUM(if(fo.`type` = 'banana',fo.value,0)) as banana,
       SUM(if(fo.`type` = 'mango',fo.value,0)) as mango
FROM Fruit_Order fo
GROUP BY fo.`date` ;
```

#### ðŸ”¥Hive SQLåˆ—è½¬è¡Œ

```text
Price ä»·ç›®è¡¨ä¸­month_codeä»£è¡¨å¹´æœˆï¼Œa/bæ˜¯äº§å“ï¼Œcn/enæ˜¯äº§åœ°
+----------+------+------+------+------+
|month_code| a_cn | a_en | b_cn | b_en |
+----------+------+------+------+------+
|  202303  |  10  |  15  |  20  |  25  |
+----------+------+------+------+------+
|  202304  |  20  |  17  |  22  |  14  |
+----------+------+------+------+------+

æœŸæœ›ç»“æžœ
+----------+------+------+------+
|month_code| item |  cn  |  en  |
+----------+------+------+------+
|  202303  |  a   |  10  |  15  |
+----------+------+------+------+
|  202303  |  b   |  20  |  25  |
+----------+------+------+------+
|  202304  |  a   |  20  |  17  |
+----------+------+------+------+
|  202304  |  b   |  22  |  14  |
+----------+------+------+------+

```

è¿™é‡Œä½¿ç”¨ `lateral view explode`å¤„ç†ï¼Œä»£ç å¦‚ä¸‹

```sql
select
  month_code,
  info.col1 as item,
  info.col2[0] as cn,
  info.col2[1] as en
from
  (
    select
      month_code,
      array(
          struct('a',array(a_cn,a_en)),
          struct('b',array(b_cn,b_en))) as arr
    from
      Price
  ) as tmp
lateral view explode(arr) tmp2 as info
```

#### æ‰¾æ¡ä»¶ç­›é€‰åŽè¿žç»­id

\*\*\[Leetcode601 ä½“è‚²é¦†çš„äººæµé‡] \*\*å†™SQLæ‰¾å‡ºæ¯è¡Œçš„äººæ•°å¤§äºŽæˆ–ç­‰äºŽ 100ä¸” idè¿žç»­çš„ä¸‰è¡Œæˆ–æ›´å¤šè¡Œè®°å½•ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```text
Stadium
+------+------------+-----------+
| id   | visit_date | people    |
+------+------------+-----------+
| 1    | 2017-01-01 | 10        |
| 2    | 2017-01-02 | 109       |
| 3    | 2017-01-03 | 150       |
| 4    | 2017-01-04 | 99        |
| 5    | 2017-01-05 | 145       |
| 6    | 2017-01-06 | 1455      |
| 7    | 2017-01-07 | 199       |
| 8    | 2017-01-09 | 188       |
+------+------------+-----------+

æœŸæœ›ç»“æžœ
+------+------------+-----------+
| id   | visit_date | people    |
+------+------------+-----------+
| 5    | 2017-01-05 | 145       |
| 6    | 2017-01-06 | 1455      |
| 7    | 2017-01-07 | 199       |
| 8    | 2017-01-09 | 188       |
+------+------------+-----------+

```

`id - row_number() over(order by id)`ï¼Œwhereç­›é€‰åŽç”¨row\_number( )æŽ’åºï¼Œç­›é€‰åŽ è¿žç»­çš„è¡Œid-row\_number( )ç›¸åŒ

```sql
select *,id - row_number() over(order by id) as rk
from stadium
where people >= 100

"""
| id | visit_date | people | rk |
| -- | ---------- | ------ | -- |
| 2  | 2017-01-02 | 109    | 1  |
| 3  | 2017-01-03 | 150    | 1  |
| 5  | 2017-01-05 | 145    | 2  |
| 6  | 2017-01-06 | 1455   | 2  |
| 7  | 2017-01-07 | 199    | 2  |
| 8  | 2017-01-09 | 188    | 2  |
"""
```
